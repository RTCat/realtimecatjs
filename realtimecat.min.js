/*! realtimecat-client-js-sdk - v0.0.5 - 2015-10-22 */function __rtc_array_remove_item(a,b){var c=a.indexOf(b);a.splice(c,1)}var RTCat=RTCat||{};RTCat.PeerConnectioin=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,RTCat.SessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,RTCat.IceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate,RTCat.GetUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,RTCat.URL=window.URL||window.webkitURL||window.msURL||window.oURL,RTCat.isMoz=!!navigator.mozGetUserMedia,RTCat.WSS="wss://api.realtimecat.com:3000/",RTCat.Poster={md1:"https://shishimao.com/img/video-placeholders/video-placeholder-256x256.png",sm2:"https://shishimao.com/img/video-placeholders/video-placeholder-128x256.png",lg2:"https://shishimao.com/img/video-placeholders/video-placeholder-512x1024.png",md2:"https://shishimao.com/img/video-placeholders/video-placeholder-256x512.png",sm1:"https://shishimao.com/img/video-placeholders/video-placeholder-128x128.png",lg1:"https://shishimao.com/img/video-placeholders/video-placeholder-512x512.png",xl1:"https://shishimao.com/img/video-placeholders/video-placeholder-1024x1024.png",xl2:"https://shishimao.com/img/video-placeholders/video-placeholder-1024x2048.png"},RTCat.DISCONNECTED=0,RTCat.CONNECTING=1,RTCat.CONNECTED=2;var RTCat=RTCat||{};RTCat.Detect=function(){function a(){var a="track"in document.createElement("track"),b=window.chrome&&window.chrome.webstore?Object.keys(window.chrome.webstore).length:0,c=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,e="undefined"!=typeof InstallTrigger,p=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,q=!!window.chrome&&!c,r=!!document.documentMode,s=/QQBrowser/.test(navigator.userAgent),t=/MetaSr/.test(navigator.userAgent),u=d(/^liebao/i,0),v=!1,w=!1;return a&&(b>1||(w=!0)),s?k:u?n:t?o:p?h:e?i:c?j:v?m:w?l:r?f:q?g:0}function b(){switch(p){case 0:return 0;case f:if(/MSIE ([\d\.]+)/.test(navigator.userAgent))return parseInt(RegExp.$1);break;case g:if(/Chrome\/([\d]+)\./.test(navigator.userAgent))return parseInt(RegExp.$1);break;case h:if(/Version\/([\d\.]+)/.test(navigator.userAgent))return parseInt(RegExp.$1);break;case i:if(/Firefox\/([\d]+)\./.test(navigator.userAgent))return parseInt(RegExp.$1);break;case j:if(/OPR\/([\d]+)\./.test(navigator.userAgent))return parseInt(RegExp.$1);break;case k:if(/QQBrowser\/([\d]+)\./.test(navigator.userAgent))return parseInt(RegExp.$1);break;default:return 0}}function c(){var a={};if(RTCat.GetUserMedia&&(a.getUserMedia=!0),RTCat.PeerConnectioin&&(a.peerConnection=!0),a.peerConnection){var b=new RTCat.PeerConnectioin({iceServers:[{url:"stun:api.shishimao.com:3478"}]});b.createDataChannel&&(a.dataChannel=!0)}return a}function d(a,b){var c=window.external||{};for(var d in c)if(a.test(b?c[d]:d))return!0;return!1}var e=this,f=1,g=2,h=3,i=4,j=5,k=6,l=7,m=8,n=9,o=10,p=a(),q=b(),r=c(),s=[g,j,k,l,m,o,i];e.isSupported=function(){for(var a in s)if(p==s[a])return!0;return!1},e.getInputDevices=function(a){try{var b=[];MediaStreamTrack.getSources(function(c){for(var d=0;d<c.length;d++){var e=c[d];b.push({type:e.kind,label:e.label,id:e.id})}a(null,b)})}catch(c){a(c)}},e.getBrowser=function(){var a;switch(p){case 0:a="unknown browser";break;case f:a="IE";break;case g:a="Chrome";break;case h:a="Safari";break;case i:a="Firefox";break;case j:a="Opera";break;case m:a="360极速浏览器";break;case l:a="360安全浏览器";break;case o:a="搜狗浏览器";break;case n:a="猎豹浏览器";break;case k:a="QQ浏览器";break;default:a="unknown browser"}return a},e.getVersion=function(){return q},e.WebRtcSupport=function(){return r}};var RTCat=RTCat||{};RTCat.Errors=function(a,b,c){var d=["Stream accepts Denied.","Set RTCat.extensionId before get ScreenSharing.","Unknown Container!","The website does not match the extension."],e=["Sending a file once time","Can not send a message while Channel is close!","Can not send a file while Channel is close!"],f=["Session has connected"],g=[d,e,f];this.name=a||"Unknown Error",this.message=g[c][b]||"Sorry, contact with RTCat for more information",this.stack=(new Error).stack},RTCat.Errors.prototype=new Error;var RTCat=RTCat||{};RTCat.EventEmitter=function(){var a={};return a.events={},a.on=function(b,c){a.events[b]=[],a.events[b].push(c)},a.off=function(b){a.events[b]&&delete a.events[b]},a.emit=function(b,c){var d,e,f=a.events[b],g=Array.prototype.slice.call(arguments,1);if(f)for(d=0,e=f.length;e>d;d++)f[d].apply(null,g)},a};var RTCat=RTCat||{};RTCat.Receiver=function(a,b){function c(){function b(a){q.stream=new RTCat.Stream({stream:a.stream,local:!1}),e(h),q.emit("stream",q.stream),q.emit("debug_log",{eventName:"receive stream"})}function c(a){q.channel=a.channel,d(q.channel),q.emit("debug_log",{eventName:"connect datachannel"})}function f(a){if(a.candidate){var b={to:n,channelId:m,candidate:a.candidate,type:"answer"};k("__ice",b),b.eventName="answer send candidate",q.emit("debug_log",b)}}function g(){h.createAnswer(function(a){h.setLocalDescription(new RTCat.SessionDescription(a),function(){var b={to:n,sdp:a,channelId:m};k("__answer",b),b.eventName="create offer",r=RTCat.CONNECTED,q.emit("debug_log",b)},l)},l)}m=a.channelId,n=a.receiver,q.attr=a.attr;var h=new RTCat.PeerConnectioin(a.iceServers);a.stream&&(h.onaddstream=b),a.data&&(h.ondatachannel=c),h.oniceconnectionstatechange=function(a){"disconnected"==h.iceConnectionState&&(q.close(),q.emit("close"))},h.onicecandidate=f,h.setRemoteDescription(new RTCat.SessionDescription(a.sdp),g,l),q.candidate=function(a){h.addIceCandidate(a),q.emit("debug_log",{eventName:"add candidate"})},q.close=function(){"closed"!==h.signalingState&&h.close(),q.channel&&q.channel.close(),q.stream&&q.stream.stop(),p&&(p={}),r=RTCat.DISCONNECTED,q.emit("close")},q.getId=function(){return m},q.getSender=function(){return n},q.getState=function(){return r},q.getFileList=function(){return p},q.getType=function(){return o}}function d(a){a.onopen=function(){q.emit("dataChannel_open")},a.onclose=function(a){q.emit("dataChannel_close")},a.onmessage=function(a){var b=JSON.parse(a.data);if("message"===b.type)q.emit("message",b.content);else if("video"===b.type);else if("file"===b.type&&(p[b.filename]=p[b.filename]||[],p[b.filename].push(b.content),b.last)){var c={blobUrl:p[b.filename].join(""),name:b.filename};c.save=function(){var a=document.createElement("a");a.href=this.blobUrl,a.target="_blank",a.download=this.name||this.blobUrl;var b=document.createEvent("Event");b.initEvent("click",!0,!0),a.dispatchEvent(b),URL.revokeObjectURL(a.href)},q.emit("file",c)}},a.onerror=function(a){q.emit("dataChannel_error",a)}}function e(a){f(a,function(b){for(var c=0;c<b.length;++c){var d=b[c];"googCandidatePair"==d.type&&g(d),"VideoBwe"==d.type&&h(d),"ssrc"==d.type&&("0"==d.googCaptureStartNtpTimeMs&&j(d),"-1"==d.googCaptureStartNtpTimeMs&&i(d))}setTimeout(function(){e(a)},1e3)})}function f(a,b){RTCat.isMoz||a.getStats(function(a){var c=[];a.result().forEach(function(a){var b={};a.names().forEach(function(c){b[c]=a.stat(c)}),b.id=a.id,b.type=a.type,b.timestamp=a.timestamp,c.push(b)}),b(c)})}function g(a){var b={};q.allReceived||(q.allReceived=a.bytesReceived);var c=a.bytesReceived-q.allReceived;q.allReceived=a.bytesReceived;var d=c/1024;q.allSent||(q.allSent=a.bytesSent);var e=a.bytesSent-q.allSent;q.allSent=a.bytesSent;var f=e/1024;b.received=d,b.sent=f,a.googLocalAddress&&(b.local_ip=a.googLocalAddress),a.googRemoteAddress&&(b.remote_ip=a.googRemoteAddress),a.googLocalCandidateType&&(b.local_candidate_type=a.googLocalCandidateType),a.googRemoteCandidateType&&(b.remote_candidate_type=a.googRemoteCandidateType),a.googTransportType&&(b.transport_protocol=a.googTransportType),a.googRtt&&(b.rtt=a.googRtt),q.emit("detect_net",b)}function h(a){var b={};a.googAvailableReceiveBandwidth&&(b.arb=a.googAvailableReceiveBandwidth),a.googAvailableSendBandwidth&&(b.asb=a.googAvailableSendBandwidth),q.emit("detect_video_bw",b)}function i(a){var b={};q.audioSent||(q.audioSent=a.bytesReceived);var c=a.bytesReceived-q.audioSent;q.audioSent=a.bytesReceived;var d=c/1024;b.received=d.toFixed(1),a.googCurrentDelayMs&&(b.delayMs=a.googCurrentDelayMs),a.packetsLost&&(b.packetsLost=a.packetsLost),a.googCodecName&&(b.codex=a.googCodecName),a.audioOutputLevel&&(b.volume_level=a.audioOutputLevel),q.emit("detect_audio",b)}function j(a){var b={};q.videoSent||(q.videoSent=a.bytesReceived);var c=a.bytesReceived-q.videoSent;q.videoSent=a.bytesReceived;var d=c/1024;b.received=d.toFixed(1),a.googCurrentDelayMs&&(b.delayMs=a.googCurrentDelayMs),a.packetsLost&&(b.packetsLost=a.packetsLost),a.googDecodeMs&&(b.decodeMs=a.googDecodeMs),q.emit("detect_video",b)}function k(a,c){b.send(JSON.stringify({eventName:a,data:c}))}function l(a){q.emit("receiver_connect_error",a)}var m,n,o="receiver",p={},q=new RTCat.EventEmitter,r=RTCat.CONNECTING;return c(),q};var RTCat=RTCat||{};RTCat.Sender=function(a,b){function c(){function b(a){if(a.candidate){var b={to:q,channelId:p,candidate:a.candidate,type:"offer"};m("__ice",b),b.eventName="offer send candidate",t.emit("debug_log",b)}}function c(b){e.setLocalDescription(new RTCat.SessionDescription(b),function(){var c={to:q,sdp:b,channelId:p,config:{stream:!!a.stream,data:a.data,attr:a.attr}};m("__offer",c),c.eventName="create offer",t.emit("debug_log",c)},n)}p=o(),q=a.to,t.attr=a.attr;var e=new RTCat.PeerConnectioin(a.iceServers);e.onicecandidate=b,a.stream&&(t.stream=a.stream,e.addStream(a.stream.getStream()),t.emit("debug_log",{eventName:"add stream"})),a.data&&(d(e),t.emit("debug_log",{eventName:"add datachannel"})),g(e),e.createOffer(c,n),t.receive=function(a){e.setRemoteDescription(new RTCat.SessionDescription(a),function(){var b={eventName:"receive answer",from:q,sdp:a};u=RTCat.CONNECTED,t.emit("debug_log",b)},n)},t.candidate=function(a){e.addIceCandidate(a),t.emit("debug_log",{eventName:"add candidate"})},t.close=function(){"closed"!==e.signalingState&&e.close(),t.channel&&t.channel.close(),u=RTCat.DISCONNECTED,t.emit("close")},t.getState=function(){return u},t.getId=function(){return p},t.getReceiver=function(){return q},t.getType=function(){return r}}function d(a){t.channel=a.createDataChannel("label"),f(t.channel)}function e(){t.sendMessage=function(a){if(u===RTCat.CONNECTED){var b={content:a,type:"message"};t.channel.send(JSON.stringify(b))}else t.emit("send_error",new RTCat.Errors("send_error",1,1))},t.sendFile=function(a){if(u===RTCat.CONNECTED)if(s)t.emit("file_sending_error",new RTCat.Errors("file_sending_error",0,1));else{s=!0;var b,c=new FileReader;c.name=a.name,c.readAsDataURL(a),c.onReadAsDataURL=function(d,e){var f={type:"file",filename:c.name},g=30720;if(d&&(e=d.target.result,b=e.length),e.length>g){var h=(b-e.length)/b;t.emit("file_sending",a.name,h),f.content=e.slice(0,g)}else t.emit("file_sent",a.name),s=!1,f.content=e,f.last=!0;t.channel.send(JSON.stringify(f));var i=e.slice(f.content.length);i.length&&setTimeout(function(){c.onReadAsDataURL(null,i)},450)},c.onload=c.onReadAsDataURL}else t.emit("send_error",new RTCat.Errors("send_error",1,2))}}function f(a){a.onopen=function(){e(),t.emit("dataChannel_open")},a.onclose=function(a){t.emit("dataChannel_close")},a.onerror=function(a){t.emit("dataChannel_error",a)}}function g(a){h(a,function(b){for(var c=0;c<b.length;++c){var d=b[c];"googCandidatePair"==d.type&&i(d),"VideoBwe"==d.type&&j(d),"ssrc"==d.type&&(d.googCpuLimitedResolution&&l(d),d.audioInputLevel&&k(d))}setTimeout(function(){g(a)},1e3)})}function h(a,b){RTCat.isMoz||a.getStats(function(a){var c=[];a.result().forEach(function(a){var b={};a.names().forEach(function(c){b[c]=a.stat(c)}),b.id=a.id,b.type=a.type,b.timestamp=a.timestamp,c.push(b)}),b(c)})}function i(a){var b={};t.allReceived||(t.allReceived=a.bytesReceived);var c=a.bytesReceived-t.allReceived;t.allReceived=a.bytesReceived;var d=c/1024;t.allSent||(t.allSent=a.bytesSent);var e=a.bytesSent-t.allSent;t.allSent=a.bytesSent;var f=e/1024;b.received=d,b.sent=f,a.googLocalAddress&&(b.local_ip=a.googLocalAddress),a.googRemoteAddress&&(b.remote_ip=a.googRemoteAddress),a.googLocalCandidateType&&(b.local_candidate_type=a.googLocalCandidateType),a.googRemoteCandidateType&&(b.remote_candidate_type=a.googRemoteCandidateType),a.googTransportType&&(b.transport_protocol=a.googTransportType),a.googRtt&&(b.rtt=a.googRtt),t.emit("detect_net",b)}function j(a){var b={};a.googAvailableReceiveBandwidth&&(b.arb=a.googAvailableReceiveBandwidth),a.googAvailableSendBandwidth&&(b.asb=a.googAvailableSendBandwidth),t.emit("detect_video_bw",b)}function k(a){var b={};t.audioSent||(t.audioSent=a.bytesSent);var c=a.bytesSent-t.audioSent;t.audioSent=a.bytesSent;var d=c/1024;b.sent=d.toFixed(1),a.googCodecName&&(b.codex=a.googCodecName),a.audioInputLevel&&(b.volume_level=a.audioInputLevel),t.emit("detect_audio",b)}function l(a){var b={};t.videoSent||(t.videoSent=a.bytesSent);var c=a.bytesSent-t.videoSent;t.videoSent=a.bytesSent;var d=c/1024;b.sent=d.toFixed(1),a.googCodecName&&(b.codex=a.googCodecName),a.googDecodeMs&&(b.decodeMs=a.googDecodeMs),t.emit("detect_video",b)}function m(a,c){b.send(JSON.stringify({eventName:a,data:c}))}function n(a){t.emit("sender_connect_error",a)}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}var p,q,r="sender",s=!1,t=new RTCat.EventEmitter,u=RTCat.CONNECTING;return c(),t};var RTCat=RTCat||{};RTCat.Session=function(a,b){function c(){e.onopen=function(){k.token=a,g=(new Date).getTime(),e.sendMessage("__join",{t:g}),l=RTCat.CONNECTED},e.onmessage=function(a){var b=JSON.parse(a.data),c=b.eventName,d=b.data;k.emit(c,d)},e.onerror=function(a){l=RTCat.DISCONNECTED,k.emit("connect_error",a)},e.onclose=function(){k.disconnect()},e.sendMessage=function(a,b){e.send(JSON.stringify({eventName:a,data:b}))}}function d(a,b){var c=atob(a),d=btoa(b);return c.replace(d,"")}var e,f,g,h={},i={},j={},k=new RTCat.EventEmitter,l=RTCat.DISCONNECTED;return k.connect=function(){l===RTCat.DISCONNECTED?(b||(b=RTCat.WSS),e=new WebSocket(b,a),c()):k.emit("connect_error",new RTCat.Errors("connect_error",0,3))},k.send=function(a){var b={iceServers:f};a&&"object"==typeof a?(a.data&&(b.data=!0),a.attr&&"object"==typeof a.attr&&(b.attr=a.attr),a.stream&&a.stream.local&&(b.stream=a.stream)):b={data:!0};for(var c in j){b.to=c;var d=new RTCat.Sender(b,e);h[c]=h[c]||{},h[c][d.getId()]=d}},k.sendTo=function(a){if(a&&"object"==typeof a&&a.to)for(var b in j)if(b==a.to){a.iceServers=f;var c=new RTCat.Sender(a,e);h[b]=h[b]||{},h[b][c.getId()]=c;break}},k.sendMessage=function(a,b){e.sendMessage("__message",{message:b,socketId:a})},k.getState=function(){return l},k.getLocal=function(){return h},k.getRemote=function(){return i},k.getWits=function(){return j},k.disconnect=function(){if(l=RTCat.DISCONNECTED,i){for(var a in i)for(var b in i[a])i[a][b].close();i={}}if(h){for(var c in h)for(var d in h[c])h[c][d].close();h={}}j&&(j={}),e.close(),k.emit("disconnected")},k.on("_join",function(a){j[a.socketId]=new RTCat.Token(a.socketId),k.emit("in",j[a.socketId].id)}),k.on("_peers",function(a){f=a.iceServer,f.iceServers[0].credential&&(f.iceServers[0].credential=d(f.iceServers[0].credential,g));var b=a.connections,c=[];for(var e in b)j[b[e]]=new RTCat.Token(b[e]),c.push(b[e]);k.emit("connected",c)}),k.on("_remove_peer",function(a){for(var b in h[a.socketId]){var c=h[a.socketId][b];c.close()}for(var d in i[a.socketId]){var e=i[a.socketId][d];e.close()}k.emit("out",j[a.socketId].id),delete j[a.socketId]}),k.on("_offer",function(a){var b=a.config;b.receiver=a.from,b.sdp=a.sdp,b.channelId=a.channelId,b.iceServers=f;var c=new RTCat.Receiver(b,e);i[a.from]=i[a.from]||{},i[a.from][a.channelId]=c,k.emit("remote",c)}),k.on("_answer",function(a){var b=h[a.from][a.channelId];b.receive(a.sdp),k.emit("local",b)}),k.on("_ice",function(a){var b;if("answer"==a.type?b=h[a.from][a.channelId]:"offer"==a.type&&i[a.from]&&(b=i[a.from][a.channelId]),b){var c=new RTCat.IceCandidate(a.candidate);b.candidate(c)}}),k.on("_message",function(a){k.emit("message",a.from,a.message)}),k.on("_error",function(a){k.emit("channel_error",a.type)}),k};var RTCat=RTCat||{};RTCat.Stream=function(a){function b(){if("object"==typeof a)if(void 0===a.local||a.local===!0){if(a.screen&&(p.screen=!0),a.video&&!p.screen&&(p.video=!0,a.ratio&&parseFloat(a.ratio)&&(m=parseFloat(a.ratio)),a.fps&&parseFloat(a.fps)&&(n=parseFloat(a.fps)),a.size&&a.size instanceof Array))for(var b in a.size)if(parseFloat(a.size[b]))switch(b){case 0:o.minWidth=parseFloat(a.size[b]);break;case 1:o.minHeight=parseFloat(a.size[b]);break;case 2:o.maxWidth=parseFloat(a.size[b]);break;case 3:o.maxHeight=parseFloat(a.size[b])}a.audio&&!p.screen&&(p.audio=!0),p.local=!0,c()}else l=a.stream,d()}function c(){p.init=function(){p.screen?e():(p.video||p.audio)&&f()}}function d(){function a(a,c){var d=document.createElement("video");d.setAttribute("width",c.width),d.setAttribute("height",c.height),d.setAttribute("autoplay","autoplay"),d.pause(),d.src=RTCat.URL.createObjectURL(l),l.getVideoTracks().length==[]&&d.setAttribute("poster",i(c.width,c.height)),p.local?(d.volume=0,d.muted=0):window.AudioContext&&l.getAudioTracks().length>0&&b();var e=document.querySelector("#"+a);return e?(e.appendChild(d),d):void p.emit("play-error",new RTCat.Errors("play-error",2,0))}function b(){var a=new AudioContext,b=a.createAnalyser(),c=a.createGain();c.connect(a.destination),c.gain.value=.9,b.smoothingTimeConstant=.3,b.fftSize=1024}p.play=function(b,c){if(!r){var d=a(b,j(c));d.play(),r=!0,p.player=d}},p.stop=function(){r&&(r=!1,p.player.remove(),delete p.player)},p.resize=function(a){if(r){var b=j(a);p.player.width=b.width,p.player.height=b.height}},p.hasAudio=function(){return l?l.getAudioTracks()&&l.getAudioTracks().length>0&&l.getAudioTracks()[0].enabled===!0:!1},p.hasVideo=function(){return l?l.getVideoTracks()&&l.getVideoTracks().length>0&&l.getVideoTracks()[0].enabled===!0:!1},p.toggleVideo=function(){l.getVideoTracks().length>0&&(l.getVideoTracks()[0].enabled=l.getVideoTracks()[0].enabled===!1)},p.toggleAudio=function(){l.getAudioTracks().length>0&&(l.getAudioTracks()[0].enabled=l.getAudioTracks()[0].enabled===!1)},p.disableVideo=function(){l.getVideoTracks().length>0&&(l.getVideoTracks()[0].enabled=!1)},p.disableAudio=function(){l.getAudioTracks().length>0&&(l.getAudioTracks()[0].enabled=!1)},p.enableVideo=function(){l.getVideoTracks().length>0&&(l.getVideoTracks()[0].enabled=!0)},p.enableAudio=function(){l.getAudioTracks().length>0&&(l.getAudioTracks()[0].enabled=!0)},p.getCapture=function(a,b){if(r){var c=!0;if(b.length<=4&&b.length>0)for(var d in b)!parseFloat(b[d])&&parseFloat(0!=b[d])&&(c=!1);else c=!1;c||(b=[0,0,p.player.width,p.player.height]);var e=a.getContext("2d");1==b.length?e.drawImage(p.player,0,0,b[0]):2==b.length?e.drawImage(p.player,0,0,b[0],b[1]):3==b.length?e.drawImage(p.player,b[0],b[1],b[2]):4==b.length&&e.drawImage(p.player,b[0],b[1],b[2],b[3])}},p.mute=function(){r&&p.local&&(p.player.muted=!0)},p.unmute=function(){r&&p.local&&(p.player.muted=!1)},p.mirror=function(){if(r){var a;a=q?1:-1,q=!q,["","moz","webkit","o","ms"].forEach(function(b){var c=b?b+"Transform":"transform";p.player.style[c]="scaleX("+a+")"})}},l.getVideoTracks().length>0?p.screen?l.getVideoTracks()[0].onended=function(){p.emit("screen-end")}:p.video&&(l.getVideoTracks()[0].onended=function(){p.emit("video-end")}):l.getAudioTracks().length>0&&p.audio&&(l.getAudioTracks()[0].onended=function(){p.emit("audio-end")}),p.getStream=function(){return l},p.getShowing=function(){return r}}function e(){RTCat.extensionId?chrome.runtime.sendMessage(RTCat.extensionId,{getStream:!0},function(a){if(a){var b=a.streamId,c={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b,maxWidth:window.screen.width,maxHeight:window.screen.height}}};RTCat.GetUserMedia.call(navigator,c,g,h)}else p.emit("access-failed",new RTCat.Errors("access-failed",3,0))}):p.emit("access-failed",new RTCat.Errors("access-failed",1,0))}function f(){var a={audio:p.audio,video:{mandatory:{},optional:[]}};m&&(a.video.mandatory.minAspectRatio=m),n&&(a.video.mandatory.maxFrameRate=n);for(var b in o)a.video.mandatory[b]=o[b];RTCat.GetUserMedia.call(navigator,a,g,h)}function g(a){l=a,d(),p.emit("access-accepted")}function h(a){p.emit("access-failed",new RTCat.Errors("access-failed",0,0))}function i(a,b){var c="1";return a/b>2&&(c="2"),128>a?poster_url=RTCat.Poster["sm"+c]:a>=128&&256>a?poster_url=RTCat.Poster["md"+c]:a>=256&&512>a?poster_url=RTCat.Poster["lg"+c]:a>=512&&(poster_url=RTCat.Poster["xl"+c]),poster_url}function j(a){return"object"==typeof a?a.width&&a.height?("string"==typeof a.width&&k(a.width)||(parseFloat(a.width)?a.width=parseFloat(a.width):a.width=300),"string"==typeof a.height&&k(a.height)||(parseFloat(a.height)?a.height=parseFloat(a.height):a.height=300)):a.width||a.height?a.width?"string"==typeof a.width&&k(a.width)||(parseFloat(a.width)?a.width=parseFloat(a.width):a.width=300):a.height&&("string"==typeof a.height&&k(a.height)||(parseFloat(a.height)?a.height=parseFloat(a.height):a.height=300)):a={width:300,height:300}:a={width:300,height:300},a}function k(a){return a.match(/^[0-9]+\.?[0-9]*\%$/)?!0:void 0}var l,m,n,o,p=new RTCat.EventEmitter,q=!1,r=!1;return b(),p};var RTCat=RTCat||{};RTCat.Token=function(a){var b=this;b.id=a};